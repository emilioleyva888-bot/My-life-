

  <!-- Tailwind CDN (lÃ©ger et suffisant pour ce projet) -->
  <script src="https://cdn.tailwindcss.com"></script>

<script>
/* ================================
   INITIALISATION
================================ */

let selectedActivity = null;
let selectedDuration = 0;

let totalTime = localStorage.getItem("totalTime")
  ? parseInt(localStorage.getItem("totalTime"))
  : 0;

const totalTimeDisplay = document.getElementById("total-time");
const gratitudeDisplay = document.getElementById("gratitude");

/* ================================
   AFFICHAGE INITIAL
================================ */

updateDisplay();

/* ================================
   BOUTONS ACTIVITÃ‰S
================================ */

document.querySelectorAll(".activity-btn").forEach(btn => {
  btn.className += " border rounded-xl p-4 text-lg font-light hover:bg-gray-100 transition";

  btn.addEventListener("click", () => {
    selectedActivity = btn.innerText;
    document.getElementById("duration-section").classList.remove("hidden");
  });
});

/* ================================
   BOUTONS DURÃ‰E RAPIDE
================================ */

document.querySelectorAll(".duration-btn").forEach(btn => {
  btn.className += " border px-4 py-2 rounded-full hover:bg-gray-100 transition";

  btn.addEventListener("click", () => {
    selectedDuration = parseInt(btn.innerText);
  });
});

/* ================================
   VALIDATION TEMPS REGAGNÃ‰
================================ */

document.getElementById("validate-btn").addEventListener("click", () => {

  const customValue = parseInt(document.getElementById("custom-duration").value);

  if (customValue) {
    selectedDuration = customValue;
  }

  if (selectedDuration > 0) {

    totalTime += selectedDuration;

    localStorage.setItem("totalTime", totalTime);

    animateCounter(totalTime);
    showGratitude(totalTime);
    resetSelection();
  }
});

/* ================================
   BOUTON TEMPS PERDU (ROUGE)
================================ */

document.getElementById("lost-time-btn").addEventListener("click", () => {

  const lost = parseInt(prompt("Combien de minutes passÃ©es sur les rÃ©seaux aujourd'hui ?"));

  if (lost && lost > 0) {

    totalTime -= lost;

    if (totalTime < 0) totalTime = 0;

    localStorage.setItem("totalTime", totalTime);

    animateCounter(totalTime);

    gratitudeDisplay.innerText =
      "Vous avez identifiÃ© " + lost + " min perdues. Demain est une nouvelle opportunitÃ©.";
  }
});

/* ================================
   ANIMATION COMPTEUR
================================ */

function animateCounter(target) {

  let current = 0;
  const increment = target / 60;

  const interval = setInterval(() => {

    current += increment;

    if (current >= target) {
      current = target;
      clearInterval(interval);
    }

    totalTimeDisplay.innerText = Math.floor(current) + " min";

  }, 20);
}

/* ================================
   AFFICHAGE & GRATITUDE
================================ */

function updateDisplay() {
  totalTimeDisplay.innerText = totalTime + " min";
  showGratitude(totalTime);
}

function showGratitude(minutes) {

  const phrases = [
    "Vous avez repris le contrÃ´le.",
    "Chaque minute compte.",
    "Votre attention est prÃ©cieuse.",
    "Vous avancez vers plus de clartÃ©."
  ];

  const hours = (minutes / 60).toFixed(1);

  gratitudeDisplay.innerText =
    phrases[Math.floor(Math.random() * phrases.length)] +
    " (" + hours + "h libÃ©rÃ©es)";
}

function resetSelection() {
  selectedDuration = 0;
  document.getElementById("custom-duration").value = "";
}

/* ================================
   NOTIFICATIONS QUOTIDIENNES 21H
================================ */

if ("Notification" in window) {
  Notification.requestPermission();
}

function scheduleDailyNotification() {

  const now = new Date();
  const target = new Date();

  target.setHours(21, 0, 0, 0);

  if (now > target) {
    target.setDate(target.getDate() + 1);
  }

  const timeout = target.getTime() - now.getTime();

  setTimeout(() => {
    showNotification();
    scheduleDailyNotification();
  }, timeout);
}

function showNotification() {

  if (Notification.permission === "granted") {
    new Notification("Temps RegagnÃ© ðŸŒ¿", {
      body: "Avez-vous repris le contrÃ´le aujourd'hui ?",
    });
  }
}

scheduleDailyNotification();

/* ================================
   SERVICE WORKER (PWA)
================================ */

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

</script>

